// Project-local debug tasks
//
// For more documentation on how to configure debug tasks,
// see: https://zed.dev/docs/debugger
[
    {
        "label": "Launch SDXL-Turbo without alpha control",
        "adapter": "Debugpy",
        "request": "launch",
        "program": "$ZED_WORKTREE_ROOT/accelerate_launch.py",
        "cwd": "$ZED_WORKTREE_ROOT",
        "env": {
            // "MODEL_NAME": "stabilityai/sdxl-turbo",
            // "VAE": "madebyollin/sdxl-vae-fp16-fix",
            // "DATASET_NAME": "ymhao/HPDv2",
            "all_proxy": "http://172.31.1.128:12798",
            "REQUESTS_CA_BUNDLE": "/etc/ssl/certs/ca-certificates.crt",
            "SSL_CERT_FILE": "/etc/ssl/certs/ca-certificates.crt",
            "_TYPER_STANDARD_TRACEBACK": "1"
        },
        "args": [
            "launch",
            "train.py",
            "--pretrained_model_name_or_path=stabilityai/sdxl-turbo",
            "--pretrained_vae_model_name_or_path=madebyollin/sdxl-vae-fp16-fix",
            "--dataset_name=ymhao/HPDv2",
            "--train_batch_size=16",
            "--dataloader_num_workers=16",
            "--gradient_accumulation_steps=128",
            "--max_train_steps=4000",
            "--lr_scheduler=constant_with_warmup",
            "--lr_warmup_steps=200",
            "--learning_rate=1e-8",
            "--scale_lr",
            "--checkpointing_steps=200",
            "--beta_dpo=5000",
            "--sdxl",
            "--resolution=512",
            "--proportion_empty_prompts=0",
            "--output_dir=2-debug",
            "--caption_column=prompt",
            "--image_column=image",
            "--ds_start_idx=200000",
            "--ds_end_idx=210000"
            // "--ds_end_idx=200100"
        ],
        "autoReload": {
            "enable": true
        },
        "jinja": true,
        "justMyCode": true
    },
    {
        "label": "Launch SDXL-Turbo with alpha control",
        "adapter": "Debugpy",
        "request": "launch",
        "program": "$ZED_WORKTREE_ROOT/accelerate_launch.py",
        "cwd": "$ZED_WORKTREE_ROOT",
        "env": {
            // "MODEL_NAME": "stabilityai/sdxl-turbo",
            // "VAE": "madebyollin/sdxl-vae-fp16-fix",
            // "DATASET_NAME": "ymhao/HPDv2",
            "all_proxy": "http://172.31.1.128:12798",
            "REQUESTS_CA_BUNDLE": "/etc/ssl/certs/ca-certificates.crt",
            "SSL_CERT_FILE": "/etc/ssl/certs/ca-certificates.crt",
            "_TYPER_STANDARD_TRACEBACK": "1"
        },
        "args": [
            "launch",
            "train.py",
            "--pretrained_model_name_or_path=stabilityai/sdxl-turbo",
            "--pretrained_vae_model_name_or_path=madebyollin/sdxl-vae-fp16-fix",
            "--dataset_name=ymhao/HPDv2",
            "--train_batch_size=16",
            "--dataloader_num_workers=16",
            "--gradient_accumulation_steps=128",
            "--max_train_steps=4000",
            "--lr_scheduler=constant_with_warmup",
            "--lr_warmup_steps=200",
            "--learning_rate=1e-8",
            "--scale_lr",
            "--checkpointing_steps=200",
            "--beta_dpo=5000",
            "--sdxl",
            "--resolution=512",
            "--proportion_empty_prompts=0",
            "--output_dir=2-debug",
            "--caption_column=prompt",
            "--image_column=image",
            "--ds_start_idx=200000",
            "--ds_end_idx=210000",
            "--alpha_control"
        ],
        "autoReload": {
            "enable": true
        },
        "jinja": true,
        "justMyCode": true
    },
    {
        "label": "Generate reward values",
        "module": "get_image_rewards.gen_reward_value",
        "cwd": "$ZED_WORKTREE_ROOT",
        "args": ["ymhao/HPDv2"],
        "adapter": "Debugpy",
        "request": "launch",
        "env": {
            "_TYPER_STANDARD_TRACEBACK": "1"
        }
    },
    {
        "label": "test load train data",
        "program": "${ZED_WORKTREE_ROOT}/test.py",
        "cwd": "${ZED_WORKTREE_ROOT}",
        "adapter": "Debugpy",
        "request": "launch",
        "justMyCode": false
    }
]
